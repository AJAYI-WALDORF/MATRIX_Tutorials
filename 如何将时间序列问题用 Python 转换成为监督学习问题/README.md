# 如何将时间序列问题用 Python 转换成为监督学习问题

一些机器学习方法（例如深度学习）可以用于进行时间序列预测。

在使用这些机器学习方法前，必须先将时间序列预测问题转化为监督学习问题。也就是说，需要将一个时间序列转换成一组包含成对输入输出的序列。

在这篇教程里，你将了解如何将单变量时间序列预测问题和多变量时间序列预测问题转换成监督学习问题，以使用机器学习算法。
读完这篇教程，你将会了解：

- 如何编写一个将时间序列数据集转换为监督学习数据集的函数。
- 如何转换一元时间序列数据以使用机器学习。
- 如何转换多元时间序列数据以使用机器学习。


### 时间序列 vs 监督学习

在正式开始之前，让我们先花点时间更好地了解一下时间序列和监督学习的数据集结构。

单个时间序列由一系列按照时间排序的数字序列组成。可以将其理解为一列有序值。

例如：

    0
    1
    2
    3
    4
    5
    6
    7
    8
    9

而一个监督学习问题是由一组输入（X）和一组输出（y）组成，算法可以学会如何通过输入值来预测输出值。

例如：

    X,  y
    1 2
    2,  3
    3,  4
    4,  5
    5,  6
    6,  7
    7,  8
    8,  9

更多知识，可以参阅：[Time Series Forecasting as Supervised Learning](https://link.juejin.im/?target=http%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-forecasting-supervised-learning%2F)


### Pandas 的 shift() 函数

我们将时间序列数据转化为监督学习问题的关键就是使用 Pandas 的 shift() 函数。

给定一个 DataFrame，shift() 函数会将输入的列复制一份，然后将副本列整体往后移动（最前面的数据空位会用 NaN 填充）或者往前移动（最后面的数据空位会用 NaN 填充）。

这样可以创建一个滞后值列，加上观察列，就能将时间序列数据集变成监督学习数据集的格式。

让我们看看 shift 函数实际用起来效果如何。

我们可以通过下面的代码模拟一个长度为 10 的时间序列数据集，此时它在 DataFrame 中为单独的一列：

    from pandas import DataFrame
    df = DataFrame()
    df['t'] = [x for x in range(10)]
    print(df)

运行上面的样例，将时间序列数据输出，其每一行都为带有索引的观察组数据

    t
    0  0
    1  1
    2  2
    3  3
    4  4
    5  5
    6  6
    7  7
    8  8
    9  9

我们可以在数据顶部插入一行，将观察组的数据整体下挪一位。由于最上面插入的新行没有数据，因此我们可以用 NaN 填充来表示这儿“没有数据”。

shift 函数可以完成这些操作。我们可以将 shift 函数“挪动”过的新列插入原始序列的旁边。

    from pandas import DataFrame
    df = DataFrame()
    df['t'] = [x for x in range(10)]
    df['t-1'] = df['t'].shift(1)
    print(df)

运行上面的样例，你将得到一个包含两列的数据集。第一列是原始的观察组，第二列是经由 shift 函数挪动生成的新列。

可以看到，经过将序列移动一次的操作之后，我们得到了一个原始的监督学习问题（虽然此时的 X 和 y 的排序明显是错的）。忽略最前面的表头，第一行存在 NaN 值，因此需要将其丢弃。在第二行，我们可以将第二列的 0.0 作为输入值（也就是 X），将第一列的 1 作为输出值（或 y）


    t  t-1
    0  0  NaN
    1  1  0.0
    2  2  1.0
    3  3  2.0
    4  4  3.0
    5  5  4.0
    6  6  5.0
    7  7  6.0
    8  8  7.0
    9  9  8.0

