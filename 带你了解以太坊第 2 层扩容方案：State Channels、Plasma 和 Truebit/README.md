## 带你了解以太坊第2层扩容方案：状态通道（State Channels）、Plasma 和 Truebit

![](https://i.imgur.com/UeEBaXo.png)


宾夕法尼亚州 Tunkhannock 地区铁路高架桥（cc）。古罗马的建筑理念在新时代的使用。

对于以太坊来说 2018 年是着力基础建设的一年。今年是初期用户来测试网络极限的一年，并将重新关注一些扩展以太坊的技术。

以太坊至今仍处于成长初期。 现今，它还不是安全的或者可扩展的。技术人员能够很清楚的认识到这一点。但是在去年，大量 ICO 所导致的炒作已经开始夸大目前的网络能力。构建一个安全，易于使用的去中心化互联网，受约于一套通用经济规范并被无数人使用，以太坊和 web3 提出的这一美好承诺就在眼前，但只有在建立关键基础设施的前提下才能够实现。

致力于构建这种基础架构和扩展以太坊性能的项目通常被称为 扩展方案（scaling solutions） 。这些项目有着不同的形式，并且通常相互兼容或互补。

这里，我想要深入讲解一种扩展方案：“off-chain” 或 “第二层（layer 2）” 方案。

- 首先，我们会全面的讨论下以太坊（以及所有公有的区块链）的扩展难题。
- 其次，我们将介绍解决扩展难题的不同方法，区分 “layer 1” 和 “layer 2” 解决方案。
- 最后，我们会深入了解第二层（layer 2）解决方案并详细解释它是怎样运作的，我们会谈及 状态通道（state channels），Plasma 和  Truebit。

本文的重点在于给读者全面而详细的讲解第二层（layer 2）解决方案的概念与工作原理。但我们不会深入研究代码或特定实现。相反，我们专注理解用于构建这些系统的经济机制以及所有第二层技术之间共同的思维模式。

1. 公有区块链的扩展难题
2. 
首先，你要知道“扩展”不是一个单一的、特定的问题，它涉及了一系列难题，必须解决这些难题才能使以太坊对全球无数用户可用。

最常讨论的扩展难题是交易通量。目前，以太坊每秒可以处理大约 15 笔交易，而 Visa 的处理能力则大约在 45,000/tps。在去年，一些应用程序（比如 Cryptokitties 或偶尔的 ICO）已经足够流行以至于“放缓了”网络速度并提升了挖矿费用（gas） 的价格。

公有区块链（比如以太坊）最核心的缺陷是要求每一笔交易要被网络中的每一个节点处理。一笔支付，Cryptokitty 的诞生，部署新的 ERC20 合约，每一个以太坊区块链上发生的操作都必须由网络中的每个节点并行执行。这是设计理念所决定的，也正是由于这种设计理念才使得公有区块链具有权威性。节点不需要依赖其他节点来告诉他们当前区块链的当前状态，它们会自己计算出来。

这给以太坊的交易通量带来了根本性的限制：它不能超过我们对于单个节点的设计要求。

我们可以要求每个节点做更多的工作，如果我们将块大小加倍(例如，区块 gas 限制)，这意味着每个节点处理每个区块的工作量大致是之前的两倍。但是这样就减弱了系统的分散化理念：节点要做更多的工作意味着性能较差的计算机（比如用户设备）可能会从网络中退出，并且挖矿也会更向性能强大的节点运营者集中。

相反，我们需要一种方式使区块链做更多有用的事，但并不是增加单个节点的工作量。

从概念上来说，有两种可能解决这个问题的方法：

一. 如果每个节点不必并行处理每个操作，会怎样？

第一种方法是抛弃我们的前提，如果我们可以构建一个每个节点不必处理每个操作的区块链，会怎样？如果网络分为两个部分代替原有网络，每一个部分都可以独立运行，会怎样？


A 部分可以处理一批交易，而同时 B 部分可以处理另一批。这实际上会使区块链的交易通量翻倍。因为我们的限制现在能够被两个节点同时处理。如果我们可以将区块链分为许多不同的部分，那么我们可以将区块链的通量提高很多倍。

这是分片（sharding）的思维模式，也是 Vitalik 的以太坊研究小组（Ethereum Research group） 和其他社群正在研究的一种扩展方案。一个区块链被分割成叫做 shards 的不同部分，每一个部分都可以独立处理交易。因为分片是在以太坊的基础级协议中实现的，所以通常被也称为第一层（layer 1）扩展解决方案，如果你想了解更多有关分片的内容，请查看 extensive FAQ 和这篇文章。

![](https://i.imgur.com/qrYKWiC.png)

二. 如果我们能够从以太坊现有能力中压榨出更多有用的业务操作

第二种选择的方向则相反：不是增加以太坊区块链本身的容量，如果我们可以通过我们已经拥有的能力来做更多的事情，会怎样？在基础级别以太坊区块链的生产力都是相同的，但是实际上，我们可以做更多对人和应用程序有用的操作，比如交易，游戏中的状态更新，或者简单的计算。

这是 “链下（off-chain）” 技术背后的思维逻辑，比如 状态通道（state channels），Plasma 和 Truebit。虽然其中每个解决方案都在解决一个不同的问题，它们都通过执行“链下”操作而且能够不在以太坊区块链上运行的同时，仍然保证足够的安全性和权威性。

这些也被称为 第二层（layer 2） 解决方案，因为它们建立在以太坊主链“之上”。他们不需要更改基本级别的协议，相反，它们只是作为作为以太坊上的智能合约，用于与链下软件进行交互。

![](https://i.imgur.com/Z1GUoH1.png)


