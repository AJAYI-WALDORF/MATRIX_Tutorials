### 用不到 200 行的 GO 语言编写您自己的区块链

世界上几乎每个开发者都听说过区块链，但大多数仍然不知道它的工作原理。他们可能仅仅是因为比特币才知道它，又或者是因为他们听说过智能合约之类的东西。这篇文章试图通过帮助您用 Go 编写自己的简单区块链，使用少于 200 行代码来揭开区块链的神秘面纱！到本教程结束时，您将能够编写并在本地运行您自己的区块链，以及在 Web 浏览器中查看它。
还有什么比通过创建自己的区块链来了解区块链更好的方法呢？

##### 您将能够做什么

- 创建您自己的区块链
- 了解 hash 如何维护区块链的完整性
- 了解如何添加新块
- 了解当多个节点生成块时，tiebreakers 如何解决
- 在 web 浏览器中查看区块链
- 写新的块
- 获取区块链的基础知识，以便您可以决定您的旅程将从这里走向何处！

##### 您不能做的事

为了保持本文的简单性，我们不会处理更高级的共识概念，比如工作证明和利害关系证明。为了让您查看您的区块链和区块的添加，我们将模拟网络交互，但网络广播作为文章的深度将被保留。

##### 准备工作

既然我们决定用 Go 编写代码，我们假设您已经有了一些 Go 方面的经验，在安装并配置 Go 之后，我们还需要获取以下软件包：

go get github.com/davecgh/go-spew/spew

Spew 允许我们在控制台中查看格式清晰的 structs 和 slices，您值得拥有。

go get github.com/gorilla/mux

Gorilla/mux 是编写 Web 程序处理的常用包。我们将会使用它。

go get github.com/joho/godotenv

Gotdotenv 允许我们从根目录中读取 .env 文件，这样就不必对 HTTP 端口之类的内容进行硬编码。我们也需要这个。

我们在根目录中创建 .env 文件，定义为 http 请求提供服务的端口。只需要该文件添加一行：

ADDR=8080

创建 main.go 文件。从现在开始，所有的内容都会写进这个文件中，并且将用少于 200 代码进行编码。

##### 导入

这是我们需要导入的以及包声明，我们把它们写入 main.go

![](https://i.imgur.com/KxlxmRU.png)

##### 数据模型

我们将定义组成区块链的每个块的 struct 。别担心，我们会在一分钟内结束所有这些字段的含义。

![](https://i.imgur.com/zUk0a47.png)

每个 Block  都包含将被写入区块链的数据，并表示当您获取脉搏率时的每一种情况（还记得您在文章的开头就这样做了么？）。

- Index 是数据记录在区块链中的位置
- Timestamp 是自动确定写入数据的时间
- BPM 每分钟节拍数，是您的脉搏率
- Hash 是表示此数据记录的 SHA256 标识符
- PrevHash 是链中上一条记录的 SHA256 标识符

我们也对区块链本身建模，它只是 Block 中的 slice:



那么散列如何适合于块和区块链呢？我们使用散列表来识别和保持块的正确顺序。通过确保每个 Block 中的 PrevHash 与前面 Block 块中的 Hash 相同，我们知道组成链的块的正确顺序。

![](https://i.imgur.com/55S897J.png)